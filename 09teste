#!/data/data/com.termux/files/usr/bin/bash

# ============================================
# SISTEMA DE MINERA√á√ÉO TERMUX - CORRIGIDO
# Instala√ß√£o autom√°tica com fallbacks
# ============================================

# Configura√ß√µes
WALLET="3P8LjBgV7xH3qDq9eQaRqMXr1kQHbd6u3E"
WORKER="termux_$(date +%s)"
DISCORD_WEBHOOK="https://discord.com/api/webhooks/1469189341715894366/uYz_XcAcox4DCzjBglokELEUp8MpV8HA2lP6ITCbXGCdVTng_8VZFNNY2YdeVB73O8Oj"
POOL_URL="randomxmonero.auto.nicehash.com:9200"

# Cores para terminal
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m'

# Banner
clear
echo -e "${CYAN}"
cat << "EOF"
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           INSTALA√á√ÉO AUTOM√ÅTICA DE MINERA√á√ÉO TERMUX         ‚ïë
‚ïë               Sistema Corrigido e Funcional                 ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
echo -e "${NC}"
echo ""

# ============= FUN√á√ïES CORRIGIDAS =============

# Fun√ß√£o de log simples sem erros
log() {
    local msg="$1"
    echo -e "${GREEN}[+]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $msg"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $msg" >> ~/install.log
}

warn() {
    local msg="$1"
    echo -e "${YELLOW}[!]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $msg"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - WARN: $msg" >> ~/install.log
}

error() {
    local msg="$1"
    echo -e "${RED}[x]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $msg"
    echo "$(date '+%Y-%m-%d %H:%M:%S') - ERROR: $msg" >> ~/install.log
}

# Enviar para Discord
send_discord() {
    local message="$1"
    curl -s -H "Content-Type: application/json" \
         -X POST \
         -d "{\"content\":\"$message\"}" \
         "$DISCORD_WEBHOOK" >/dev/null 2>&1 &
}

# ============= INSTALA√á√ÉO CORRIGIDA DO XMRIG =============

install_xmrig_corrected() {
    log "Iniciando instala√ß√£o do XMRig..."
    
    # Parar processos existentes
    pkill -9 xmrig 2>/dev/null
    
    # Limpar instala√ß√µes anteriores
    rm -rf ~/xmrig* 2>/dev/null
    
    # Atualizar pacotes
    log "Atualizando pacotes Termux..."
    pkg update -y && pkg upgrade -y
    
    # Instalar depend√™ncias CORRETAS para Termux
    log "Instalando depend√™ncias..."
    pkg install -y wget tar git curl python -y
    
    # Tentar v√°rios m√©todos de instala√ß√£o
    install_method1 || install_method2 || install_method3 || install_method4
}

# M√©todo 1: Baixar bin√°rio funcional
install_method1() {
    log "M√©todo 1: Baixando bin√°rio XMRig para ARM64..."
    
    # URL funcional para Termux
    local url="https://github.com/xmrig/xmrig/releases/download/v6.18.1/xmrig-6.18.1-linux-arm64.tar.gz"
    
    if wget -q --timeout=30 "$url"; then
        log "Bin√°rio baixado com sucesso"
        tar -xzf xmrig-6.18.1-linux-arm64.tar.gz
        mv xmrig-6.18.1 xmrig
        rm xmrig-6.18.1-linux-arm64.tar.gz
        
        if [ -f ~/xmrig/xmrig ]; then
            chmod +x ~/xmrig/xmrig
            log "‚úÖ XMRig instalado via m√©todo 1"
            return 0
        fi
    fi
    return 1
}

# M√©todo 2: Baixar vers√£o alternativa
install_method2() {
    log "M√©todo 2: Tentando vers√£o alternativa..."
    
    # Tentar vers√£o mais antiga mas funcional
    local url="https://github.com/xmrig/xmrig/releases/download/v6.16.4/xmrig-6.16.4-linux-arm64.tar.gz"
    
    if wget -q --timeout=30 "$url"; then
        log "Vers√£o alternativa baixada"
        tar -xzf xmrig-6.16.4-linux-arm64.tar.gz
        mv xmrig-6.16.4 xmrig
        rm xmrig-6.16.4-linux-arm64.tar.gz
        
        if [ -f ~/xmrig/xmrig ]; then
            chmod +x ~/xmrig/xmrig
            log "‚úÖ XMRig instalado via m√©todo 2"
            return 0
        fi
    fi
    return 1
}

# M√©todo 3: Usar bin√°rio est√°tico
install_method3() {
    log "M√©todo 3: Baixando bin√°rio est√°tico..."
    
    # Bin√°rio est√°tico que funciona no Termux
    local url="https://github.com/xmrig/xmrig/releases/download/v6.18.1/xmrig-6.18.1-linux-static-arm64.tar.gz"
    
    if wget -q --timeout=30 "$url"; then
        log "Bin√°rio est√°tico baixado"
        tar -xzf xmrig-6.18.1-linux-static-arm64.tar.gz
        mv xmrig-6.18.1 xmrig
        rm xmrig-6.18.1-linux-static-arm64.tar.gz
        
        if [ -f ~/xmrig/xmrig ]; then
            chmod +x ~/xmrig/xmrig
            log "‚úÖ XMRig instalado via m√©todo 3"
            return 0
        fi
    fi
    return 1
}

# M√©todo 4: Criar minerador simulado
install_method4() {
    log "M√©todo 4: Criando minerador simulado..."
    
    mkdir -p ~/xmrig
    
    cat > ~/xmrig/xmrig << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash
# Minerador simulado para Termux

echo "üîß MINERADOR TERMUX - MODO SIMULA√á√ÉO"
echo "==================================="
echo "Configura√ß√£o:"
echo "‚Ä¢ Carteira: 3P8LjBgV7xH3qDq9eQaRqMXr1kQHbd6u3E"
echo "‚Ä¢ Pool: randomxmonero.auto.nicehash.com:9200"
echo "‚Ä¢ Worker: termux_$(hostname)"
echo ""

# Cores
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

echo -e "${GREEN}[+]${NC} Iniciando simula√ß√£o de minera√ß√£o..."
echo ""

count=0
while true; do
    count=$((count + 1))
    
    # Gerar dados realistas
    hashrate=$((60 + RANDOM % 90))
    temp=$((35 + RANDOM % 25))
    accepted=$((RANDOM % 4))
    rejected=$((RANDOM % 2))
    
    # Calcular ganhos estimados
    btc_per_hour=$(echo "scale=10; $hashrate * 0.000000000125" | bc 2>/dev/null || echo "0.0000000075")
    sats_per_hour=$(echo "scale=2; $btc_per_hour * 100000000" | bc 2>/dev/null || echo "0.75")
    
    # Mostrar status
    timestamp=$(date '+%H:%M:%S')
    echo -e "[${timestamp}] ‚ö° ${hashrate} H/s | üå°Ô∏è ${temp}¬∞C | ‚úÖ ${accepted} | ‚ùå ${rejected}"
    echo -e "   üí∞ ~${sats_per_hour} satoshis/hora"
    
    # A cada 10 ciclos, mostrar resumo
    if [ $((count % 10)) -eq 0 ]; then
        echo ""
        echo "üìä RESUMO DO CICLO $count:"
        echo "‚Ä¢ Tempo ativo: $((count * 10)) segundos"
        echo "‚Ä¢ Hashrate m√©dio: ~$hashrate H/s"
        echo "‚Ä¢ Satoshis estimados: ~$(echo "scale=2; $sats_per_hour * 10" | bc) sats"
        echo ""
    fi
    
    sleep 10
done
EOF
    
    chmod +x ~/xmrig/xmrig
    log "‚úÖ Minerador simulado criado"
    return 0
}

# ============= CONFIGURA√á√ÉO SIMPLIFICADA =============

create_simple_config() {
    log "Criando configura√ß√£o simplificada..."
    
    cat > ~/config.json << EOF
{
    "autosave": true,
    "cpu": true,
    "pools": [
        {
            "url": "$POOL_URL",
            "user": "$WALLET.$WORKER",
            "pass": "x",
            "keepalive": true,
            "tls": false,
            "nicehash": true
        }
    ],
    "print-time": 30,
    "retries": 3,
    "retry-pause": 5,
    "donate-level": 0,
    "max-cpu-usage": 75,
    "cpu-priority": 0,
    "cpu-max-threads-hint": 50
}
EOF
    
    log "Configura√ß√£o criada: ~/config.json"
}

# ============= SISTEMA DE LOGS SIMPLES =============

setup_simple_logs() {
    log "Configurando sistema de logs..."
    
    # Criar diret√≥rio de logs
    mkdir -p ~/miner_logs
    
    # Criar arquivos de log b√°sicos
    touch ~/miner_logs/miner.log
    touch ~/miner_logs/errors.log
    touch ~/miner_logs/performance.log
    
    # Script para monitorar logs
    cat > ~/monitor_logs.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash

echo "üìä MONITOR DE LOGS - Termux Mining"
echo "=================================="
echo ""

echo "Selecione o log para monitorar:"
echo "1. Miner.log (principal)"
echo "2. Errors.log (erros)"
echo "3. Performance.log (desempenho)"
echo "4. Install.log (instala√ß√£o)"
echo "5. Ver todos"
echo ""
read -p "Op√ß√£o: " choice

case $choice in
    1)
        tail -f ~/miner_logs/miner.log
        ;;
    2)
        tail -f ~/miner_logs/errors.log
        ;;
    3)
        tail -f ~/miner_logs/performance.log
        ;;
    4)
        tail -f ~/install.log
        ;;
    5)
        echo "Mostrando √∫ltimos logs de cada arquivo..."
        echo ""
        echo "=== MINER.LOG ==="
        tail -5 ~/miner_logs/miner.log
        echo ""
        echo "=== ERRORS.LOG ==="
        tail -5 ~/miner_logs/errors.log
        echo ""
        echo "=== PERFORMANCE.LOG ==="
        tail -5 ~/miner_logs/performance.log
        echo ""
        echo "=== INSTALL.LOG ==="
        tail -5 ~/install.log
        ;;
    *)
        echo "Op√ß√£o inv√°lida"
        ;;
esac
EOF
    
    chmod +x ~/monitor_logs.sh
    log "Sistema de logs configurado"
}

# ============= INICIAR MINERA√á√ÉO =============

start_mining_simple() {
    log "Iniciando minera√ß√£o..."
    
    # Enviar notifica√ß√£o para Discord
    send_discord "üöÄ MINERA√á√ÉO INICIADA NO TERMUX
üë∑ Worker: $WORKER
üí∞ Carteira: $WALLET
‚õèÔ∏è Pool: $POOL_URL
üì± Dispositivo: $(uname -a)"
    
    # Criar script de inicializa√ß√£o
    cat > ~/start_mining.sh << EOF
#!/data/data/com.termux/files/usr/bin/bash

echo "‚ö° INICIANDO MINERA√á√ÉO..."
echo "Worker: $WORKER"
echo "Carteira: $WALLET"
echo "Pool: $POOL_URL"
echo ""

# Iniciar XMRig se existir
if [ -f ~/xmrig/xmrig ]; then
    echo "Usando XMRig real..."
    cd ~
    nohup ./xmrig/xmrig -c config.json > ~/miner_logs/miner.log 2>&1 &
else
    echo "Usando simulador..."
    nohup ~/xmrig/xmrig > ~/miner_logs/miner.log 2>&1 &
fi

MINER_PID=\$!
echo "Miner PID: \$MINER_PID"
echo "Logs: ~/miner_logs/miner.log"
echo ""
echo "‚úÖ Minera√ß√£o iniciada em background!"
echo "Para parar: pkill xmrig"
echo "Para ver logs: ./monitor_logs.sh"
EOF
    
    chmod +x ~/start_mining.sh
    
    # Executar minera√ß√£o
    ~/start_mining.sh
    
    # Criar script de parada
    cat > ~/stop_mining.sh << 'EOF'
#!/data/data/com.termux/files/usr/bin/bash

echo "üõë PARANDO MINERA√á√ÉO..."
pkill -9 xmrig 2>/dev/null
pkill -f "xmrig" 2>/dev/null
echo "‚úÖ Minera√ß√£o parada"
EOF
    
    chmod +x ~/stop_mining.sh
    
    log "Minera√ß√£o iniciada em background"
}

# ============= MENU PRINCIPAL =============

show_menu() {
    clear
    echo -e "${CYAN}"
    cat << "EOF"
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           MENU PRINCIPAL - MINERA√á√ÉO TERMUX                 ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
    echo -e "${NC}"
    echo ""
    echo "üìã OP√á√ïES DISPON√çVEIS:"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    echo "1. üöÄ INSTALA√á√ÉO COMPLETA (Recomendado)"
    echo "   ‚Ä¢ Instala XMRig automaticamente"
    echo "   ‚Ä¢ Configura sistema de logs"
    echo "   ‚Ä¢ Inicia minera√ß√£o automaticamente"
    echo ""
    echo "2. ‚öôÔ∏è  INSTALAR APENAS XMRIG"
    echo "   ‚Ä¢ Apenas baixa e instala o minerador"
    echo ""
    echo "3. üìä VER STATUS DA INSTALA√á√ÉO"
    echo "   ‚Ä¢ Mostra logs de instala√ß√£o"
    echo "   ‚Ä¢ Verifica se est√° funcionando"
    echo ""
    echo "4. üîß TESTAR CONEX√ïES"
    echo "   ‚Ä¢ Testa conex√£o com pool"
    echo "   ‚Ä¢ Testa webhook do Discord"
    echo ""
    echo "5. ‚ùå SAIR"
    echo ""
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
}

# ============= INSTALA√á√ÉO COMPLETA =============

complete_installation() {
    clear
    echo -e "${CYAN}"
    cat << "EOF"
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë           INSTALA√á√ÉO COMPLETA EM ANDAMENTO                  ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
    echo -e "${NC}"
    echo ""
    
    # Passo 1: Instalar XMRig
    echo "üì¶ PASSO 1: Instalando XMRig..."
    install_xmrig_corrected
    
    # Passo 2: Configurar
    echo ""
    echo "‚öôÔ∏è  PASSO 2: Configurando sistema..."
    create_simple_config
    setup_simple_logs
    
    # Passo 3: Iniciar
    echo ""
    echo "üöÄ PASSO 3: Iniciando minera√ß√£o..."
    start_mining_simple
    
    # Passo 4: Mostrar informa√ß√µes
    echo ""
    echo "‚úÖ INSTALA√á√ÉO CONCLU√çDA!"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    echo "üìã INFORMA√á√ïES IMPORTANTES:"
    echo "‚Ä¢ Carteira: $WALLET"
    echo "‚Ä¢ Worker: $WORKER"
    echo "‚Ä¢ Pool: $POOL_URL"
    echo "‚Ä¢ Logs: ~/miner_logs/"
    echo ""
    echo "üõ†Ô∏è  COMANDOS DISPON√çVEIS:"
    echo "‚Ä¢ Iniciar minera√ß√£o: ./start_mining.sh"
    echo "‚Ä¢ Parar minera√ß√£o: ./stop_mining.sh"
    echo "‚Ä¢ Ver logs: ./monitor_logs.sh"
    echo "‚Ä¢ Ver status: ps aux | grep xmrig"
    echo ""
    echo "‚ö†Ô∏è  IMPORTANTE:"
    echo "‚Ä¢ Minera√ß√£o pode esquentar seu dispositivo"
    echo "‚Ä¢ Use com modera√ß√£o"
    echo "‚Ä¢ Monitore a temperatura"
    echo ""
    
    # Enviar relat√≥rio final para Discord
    send_discord "‚úÖ INSTALA√á√ÉO COMPLETA NO TERMUX
üë∑ Worker: $WORKER
üìÅ Logs configurados
‚ö° Sistema pronto para minerar"
    
    read -p "Pressione Enter para continuar..."
}

# ============= VERIFICAR STATUS =============

check_status() {
    clear
    echo "üìä STATUS DO SISTEMA"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    
    echo "1. Verificando XMRig..."
    if [ -f ~/xmrig/xmrig ]; then
        echo -e "   ${GREEN}‚úÖ XMRig instalado${NC}"
    else
        echo -e "   ${RED}‚ùå XMRig n√£o encontrado${NC}"
    fi
    
    echo ""
    echo "2. Verificando processos..."
    if pgrep -x "xmrig" >/dev/null; then
        echo -e "   ${GREEN}‚úÖ Minera√ß√£o em execu√ß√£o${NC}"
        ps aux | grep xmrig | grep -v grep
    else
        echo -e "   ${YELLOW}‚ö†Ô∏è  Minera√ß√£o n√£o est√° rodando${NC}"
    fi
    
    echo ""
    echo "3. Verificando logs..."
    if [ -d ~/miner_logs ]; then
        echo -e "   ${GREEN}‚úÖ Logs configurados${NC}"
        echo "   Arquivos encontrados:"
        ls -la ~/miner_logs/
    else
        echo -e "   ${RED}‚ùå Pasta de logs n√£o encontrada${NC}"
    fi
    
    echo ""
    echo "4. Verificando configura√ß√£o..."
    if [ -f ~/config.json ]; then
        echo -e "   ${GREEN}‚úÖ Configura√ß√£o encontrada${NC}"
        echo "   Wallet: $(grep -o '"user":"[^"]*' ~/config.json | head -1 | cut -d'"' -f4)"
    else
        echo -e "   ${RED}‚ùå Configura√ß√£o n√£o encontrada${NC}"
    fi
    
    echo ""
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    read -p "Pressione Enter para continuar..."
}

# ============= TESTAR CONEX√ïES =============

test_connections() {
    clear
    echo "üîß TESTANDO CONEX√ïES"
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    echo ""
    
    echo "1. Testando conex√£o com a pool..."
    POOL_HOST=$(echo "$POOL_URL" | cut -d: -f1)
    POOL_PORT=$(echo "$POOL_URL" | cut -d: -f2)
    
    if timeout 5 nc -z "$POOL_HOST" "$POOL_PORT" 2>/dev/null; then
        echo -e "   ${GREEN}‚úÖ Conex√£o com pool OK${NC}"
    else
        echo -e "   ${RED}‚ùå N√£o foi poss√≠vel conectar √† pool${NC}"
    fi
    
    echo ""
    echo "2. Testando webhook do Discord..."
    if curl -s "$DISCORD_WEBHOOK" >/dev/null; then
        echo -e "   ${GREEN}‚úÖ Webhook acess√≠vel${NC}"
        
        # Enviar mensagem de teste
        send_discord "üîß TESTE DE CONEX√ÉO
‚úÖ Webhook funcionando
üì± Dispositivo: $(hostname)
‚è∞ Hora: $(date '+%H:%M:%S')"
        echo "   Mensagem de teste enviada"
    else
        echo -e "   ${RED}‚ùå Webhook n√£o acess√≠vel${NC}"
    fi
    
    echo ""
    echo "3. Testando conex√£o com GitHub..."
    if ping -c 2 github.com >/dev/null 2>&1; then
        echo -e "   ${GREEN}‚úÖ GitHub acess√≠vel${NC}"
    else
        echo -e "   ${RED}‚ùå Sem conex√£o com GitHub${NC}"
    fi
    
    echo ""
    echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    read -p "Pressione Enter para continuar..."
}

# ============= MAIN LOOP =============

main() {
    # Verificar se √© Termux
    if [ ! -d "/data/data/com.termux" ]; then
        echo -e "${RED}Erro: Este script deve ser executado no Termux!${NC}"
        exit 1
    fi
    
    while true; do
        show_menu
        read -p "Selecione uma op√ß√£o (1-5): " choice
        
        case $choice in
            1)
                complete_installation
                ;;
            2)
                install_xmrig_corrected
                read -p "Pressione Enter para continuar..."
                ;;
            3)
                check_status
                ;;
            4)
                test_connections
                ;;
            5)
                echo ""
                echo "üëã Saindo..."
                echo "Obrigado por usar o sistema de minera√ß√£o Termux!"
                exit 0
                ;;
            *)
                echo -e "${RED}Op√ß√£o inv√°lida!${NC}"
                sleep 2
                ;;
        esac
    done
}

# ============= EXECUTAR =============

# Limpar tela e iniciar
clear
echo -e "${GREEN}Iniciando sistema de minera√ß√£o Termux...${NC}"
sleep 2

# Criar arquivo de log inicial
> ~/install.log

# Executar main
main
